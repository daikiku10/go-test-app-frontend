import { useState, useReducer } from 'react'
import Head from 'next/head'
import styles from '@/styles/Home.module.css'
import AddTask from '@/components/AddTask'
import { Task, TaskAction } from '@/types/task'
import TaskList from '@/components/TaskList'
import { TasksContext, TasksDispatchContext } from '@/context/TasksContext'

const initialTasks = [
  {id: 0, text: 'Visit Kafka Museum', done: true},
  {id: 1, text: 'Watch a puppet show', done: false},
  {id: 2, text: 'Lennon Wall pic', done: false},
];

export default function Home() {
  const [tasks, dispatch] = useReducer(tasksReducer, initialTasks);
  
  // Reducer関数
  function tasksReducer(tasks: Task[], action: TaskAction) {
    switch (action.type) {
      case 'added': {
        console.log('追加しますよ！');
        return [
          ...tasks,
          {
            id: action.id,
            text: action.text,
            done: false,
          },
        ];
      }
      case 'changed': {
        console.log('変更しますよ！');
        return tasks.map((t) => {
          if (t.id === action.task.id) {
            return action.task;
          }
          return t;
        });
      }
      case 'deleted': {
        console.log('削除しますよ！');
        return tasks.filter((t) => t.id !== action.id);
      }
      default: {
        throw Error('Unknown action');
      }
    }
  }
  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={styles.main}>
        <h1>Prague itinerary</h1>

        <TasksContext.Provider value={tasks}>
          <TasksDispatchContext.Provider value={dispatch}>
            <AddTask />
            <TaskList />
          </TasksDispatchContext.Provider>
        </TasksContext.Provider>
      </main>
    </>
  )
}
